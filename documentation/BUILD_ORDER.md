# LibFVDE Overlay Build Order

This document describes the build order for all libraries in the libfvde-overlay.

## Overview

The overlay contains 18 library packages that must be built in dependency order:
- 17 supporting libraries from libyal
- 1 main library (libfvde)

## Build Order

### Tier 1: Base Libraries (no external libyal dependencies)
1. `dev-libs/libcerror` - Error handling library
2. `dev-libs/libclocale` - Locale functions
3. `dev-libs/libcnotify` - Notification functions
4. `dev-libs/libcsplit` - String splitting functions
5. `dev-libs/libfguid` - GUID/UUID handling
6. `dev-libs/libhmac` - HMAC functions
7. `dev-libs/libcaes` - AES encryption

### Tier 2: Libraries depending on Tier 1
8. `dev-libs/libcthreads` - Threading library (depends on: libcerror)
9. `dev-libs/libuna` - Unicode/ASCII conversions (depends on: libcerror)

### Tier 3: Libraries depending on Tiers 1-2
10. `dev-libs/libcdata` - Generic data structures (depends on: libcerror, libcthreads)
11. `dev-libs/libcfile` - File I/O (depends on: libcerror, libclocale, libcnotify, libuna)
12. `dev-libs/libcpath` - Path handling (depends on: libcerror, libclocale, libcsplit, libcnotify, libuna)

### Tier 4: Libraries depending on Tiers 1-3
13. `dev-libs/libfcache` - File cache (depends on: libcerror, libcdata, libcthreads)
14. `dev-libs/libbfio` - Basic file I/O abstraction (depends on: libcerror, libcdata, libcfile, libcpath, libcthreads, libuna)
15. `dev-libs/libfvalue` - File value types (depends on: libcerror, libcdata, libcnotify, libuna)
16. `dev-libs/libfplist` - Property list handling (depends on: libcerror, libfguid, libcdata, libcnotify)

### Tier 5: Libraries depending on Tiers 1-4
17. `dev-libs/libfdata` - File data types (depends on: libcerror, libcdata, libcnotify, libcthreads, libfcache)

### Main Library
18. `dev-libs/libfvde` - FileVault Drive Encryption library (depends on all 17 libraries above)

## Quick Build Commands

To build all libraries in order:

```bash
# Tier 1
sudo emerge -av libcerror libclocale libcnotify libcsplit libfguid libhmac libcaes

# Tier 2
sudo emerge -av libcthreads libuna

# Tier 3
sudo emerge -av libcdata libcfile libcpath

# Tier 4
sudo emerge -av libfcache libbfio libfvalue libfplist

# Tier 5
sudo emerge -av libfdata

# Main library
sudo emerge -av libfvde
```

Or build everything at once (emerge will handle dependencies):

```bash
sudo emerge -av dev-libs/libfvde::libfvde-overlay
```

## USE Flags

All libraries support:
- `nls` - Native language support
- `static-libs` - Build static libraries instead of shared

When `static-libs` is enabled:
- Libraries become build-time only dependencies (DEPEND)
- Runtime dependencies (RDEPEND) are not installed
- `.a` files are installed and `.la` files are preserved

The main `libfvde` package additionally supports:
- `fuse` - Build FUSE filesystem support
- `python` - Build Python bindings
- `tools` - Install command-line tools (default: enabled)
- `keyring` - Linux kernel keyring support (default: enabled)

## Testing Individual Builds

To test compilation without installing:

```bash
ebuild /var/db/repos/libfvde-overlay/dev-libs/LIBNAME/LIBNAME-9999.ebuild clean compile
```

## Package Structure

Each package includes:
- Ebuild file: `LIBNAME-9999.ebuild` (live git version)
- Patch file: `files/0001-Remove-embedded-dependencies-for-system-library-buil.patch`
- Manifest: `Manifest` (generated by ebuild command)

## Notes

- All packages fetch from GitHub using git-r3.eclass
- Patches remove embedded library directories to use system libraries
- Build system uses autotools (autoconf, automake, libtool)
